
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>키움증권 OpenAPI+ 사용 예시 &#8212; KOAPY 0.3.5 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/style.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="과거 주식 가격 데이터 확보를 위해 지금까지 삽질해 본 것들" href="getting-historical-stock-price-data.html" />
    <link rel="prev" title="Notebook" href="../notebook.html" />
  
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  
  <meta name="google-site-verification" content="DIMzk5-2xmV7MoAYJYUGi1PGowNXA7NB8dome7s1e5k" />
  

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">KOAPY</a></h1>



<p class="blurb">Kiwoom Open Api Plus Python</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=elbakramer&repo=koapy&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../readme.html">KOAPY</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../history.html">History</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../notebook.html">Notebook</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">키움증권 OpenAPI+ 사용 예시</a></li>
<li class="toctree-l2"><a class="reference internal" href="getting-historical-stock-price-data.html">과거 주식 가격 데이터 확보를 위해 지금까지 삽질해 본 것들</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/index.html">API Reference</a></li>
</ul>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">KOAPY</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../history.html">History</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autoapi/index.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../notebook.html">Notebook</a><ul>
      <li>Previous: <a href="../notebook.html" title="previous chapter">Notebook</a></li>
      <li>Next: <a href="getting-historical-stock-price-data.html" title="next chapter">과거 주식 가격 데이터 확보를 위해 지금까지 삽질해 본 것들</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>


<h3 class="donation">Donate/support</h3>



<p>
<a class="badge" href="https://toon.at/donate/637521884081401532">
<img src="https://img.shields.io/badge/donate-%E2%9D%A4%C2%A0-ff69b4.svg?style=flat" alt="Donate">
</a>
</p>





        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="키움증권-OpenAPI+-사용-예시">
<h1>키움증권 OpenAPI+ 사용 예시<a class="headerlink" href="#키움증권-OpenAPI+-사용-예시" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
    <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> [</span><span class="si">%(levelname)s</span><span class="s1">] </span><span class="si">%(message)s</span><span class="s1"> - </span><span class="si">%(filename)s</span><span class="s1">:</span><span class="si">%(lineno)d</span><span class="s1">&#39;</span><span class="p">,</span>
    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;matplotlib&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="1.-엔트리포인트-객체-생성">
<h2>1. 엔트리포인트 객체 생성<a class="headerlink" href="#1.-엔트리포인트-객체-생성" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">koapy</span> <span class="kn">import</span> <span class="n">KiwoomOpenApiPlusEntrypoint</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-05-13 23:46:01,155 [INFO] Note: NumExpr detected 12 cores but &#34;NUMEXPR_MAX_THREADS&#34; not set, so enforcing safe limit of 8. - utils.py:129
2021-05-13 23:46:01,158 [INFO] NumExpr defaulting to 8 threads. - utils.py:141
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">entrypoint</span> <span class="o">=</span> <span class="n">KiwoomOpenApiPlusEntrypoint</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-05-13 23:46:06,458 [DEBUG] Testing if client is ready... - KiwoomOpenApiPlusEntrypoint.py:96
2021-05-13 23:46:06,467 [DEBUG] Client is ready, using existing server - KiwoomOpenApiPlusEntrypoint.py:106
</pre></div></div>
</div>
<p>주요한 기능들은 해당 엔트리포인트의 멤버함수로써 제공된다.</p>
<p>예를 들어 아래와 같이 서버 접속 이전에도 실행 가능한 아래 함수를 활용하면 OpenAPI 가 정상적으로 로드되었는지 간접적으로 확인 가능하다.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">module_path</span> <span class="o">=</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">GetAPIModulePath</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">module_path</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;C:\\OpenAPI&#39;
</pre></div></div>
</div>
</section>
<section id="2.-서버-접속">
<h2>2. 서버 접속<a class="headerlink" href="#2.-서버-접속" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">entrypoint</span><span class="o">.</span><span class="n">EnsureConnected</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>자동 로그인 설정이 되어있는 경우 로그인이 자동으로 처리되며, 그렇지 않은 경우에는 수동으로 아이디, 비밀번호 등 로그인 정보를 입력해 처리해주어야 한다.</p>
<p>만약에 함수 인자로 <code class="docutils literal notranslate"><span class="pre">credential</span></code> 정보를 주는 경우 <code class="docutils literal notranslate"><span class="pre">`pywinauto</span></code> &lt;<a class="reference external" href="https://github.com/pywinauto/pywinauto">https://github.com/pywinauto/pywinauto</a>&gt;`__ 를 활용하여 자동으로 로그인 처리를 진행한다. 앞서 언급한 키움증권에서 기본으로 제공하는 자동 로그인이 아니라 기존에 수동으로 처리하던 과정을 매크로 형태로 자동으로 처리하는 방식이다. 참고로 <code class="docutils literal notranslate"><span class="pre">`pywinauto</span></code> &lt;<a class="reference external" href="https://github.com/pywinauto/pywinauto">https://github.com/pywinauto/pywinauto</a>&gt;`__ 사용을 위해서는 <strong>관리자 권한</strong>이 필요하다.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">credential</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
    <span class="s1">&#39;user_password&#39;</span><span class="p">:</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cert_password&#39;</span><span class="p">:</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
    <span class="s1">&#39;is_simulation&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;account_passwords&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;0000000000&#39;</span><span class="p">:</span> <span class="s1">&#39;0000&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">entrypoint</span><span class="o">.</span><span class="n">EnsureConnected</span><span class="p">(</span><span class="n">credential</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0
</pre></div></div>
</div>
<p>참고로 여기서는 이미 로그인이 되어있는 상황이므로 위의 함수가 추가적인 로그인처리를 진행하지는 않게 된다.</p>
</section>
<section id="3.-기본-함수-실행">
<h2>3. 기본 함수 실행<a class="headerlink" href="#3.-기본-함수-실행" title="Permalink to this headline">¶</a></h2>
<p>다시 한번 기본 함수를 통해 접속상태를 확인해보자. 아래 값이 1 인 경우 정상 접속 상태이다. 접속되어 있지 않은 경우라면 0 을 반환한다.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">entrypoint</span><span class="o">.</span><span class="n">GetConnectState</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1
</pre></div></div>
</div>
<p>이후 예시들에서 사용하기 위해 삼성전자의 코드를 확인한다.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">codes</span> <span class="o">=</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">GetCodeListByMarketAsList</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">entrypoint</span><span class="o">.</span><span class="n">GetMasterCodeName</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="k">for</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">codes_by_name</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">codes</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>위에서 <code class="docutils literal notranslate"><span class="pre">GetCodeListByMarketAsList()</span></code> 함수는 기존의 <code class="docutils literal notranslate"><span class="pre">GetCodeListByMarket()</span></code> 함수 호출시 나오는 문자열 형태의 결과를 편의를 위해 리스트 형태로 변환해서 제공한다.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">code</span> <span class="o">=</span> <span class="n">samsung_code</span> <span class="o">=</span> <span class="n">codes_by_name</span><span class="p">[</span><span class="s1">&#39;삼성전자&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">code</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;005930&#39;
</pre></div></div>
</div>
</section>
<section id="4.-TR-요청-예시">
<h2>4. TR 요청 예시<a class="headerlink" href="#4.-TR-요청-예시" title="Permalink to this headline">¶</a></h2>
<section id="상위-함수-사용-예시">
<h3>상위 함수 사용 예시<a class="headerlink" href="#상위-함수-사용-예시" title="Permalink to this headline">¶</a></h3>
<p>몇가지 자주 쓰이는 TR 들에 대해서는 요청 및 결과 이벤트 처리까지 완료해서 결과물만 반환하는 상위함수를 제공하고 있다.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">info</span> <span class="o">=</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">GetStockBasicInfoAsDict</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="c1"># opt10001</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">info</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;종목코드&#39;: &#39;005930&#39;,
 &#39;종목명&#39;: &#39;삼성전자&#39;,
 &#39;결산월&#39;: &#39;12&#39;,
 &#39;액면가&#39;: &#39;100&#39;,
 &#39;자본금&#39;: &#39;7780&#39;,
 &#39;상장주식&#39;: &#39;5969783&#39;,
 &#39;신용비율&#39;: &#39;+0.16&#39;,
 &#39;연중최고&#39;: &#39;+96800&#39;,
 &#39;연중최저&#39;: &#39;-78400&#39;,
 &#39;시가총액&#39;: &#39;4686279&#39;,
 &#39;시가총액비중&#39;: &#39;&#39;,
 &#39;외인소진률&#39;: &#39;+53.91&#39;,
 &#39;대용가&#39;: &#39;64000&#39;,
 &#39;PER&#39;: &#39;20.44&#39;,
 &#39;EPS&#39;: &#39;3841&#39;,
 &#39;ROE&#39;: &#39;10.0&#39;,
 &#39;PBR&#39;: &#39;1.99&#39;,
 &#39;EV&#39;: &#39;5.49&#39;,
 &#39;BPS&#39;: &#39;39406&#39;,
 &#39;매출액&#39;: &#39;2368070&#39;,
 &#39;영업이익&#39;: &#39;359939&#39;,
 &#39;당기순이익&#39;: &#39;264078&#39;,
 &#39;250최고&#39;: &#39;+96800&#39;,
 &#39;250최저&#39;: &#39;-47200&#39;,
 &#39;시가&#39;: &#39;-78900&#39;,
 &#39;고가&#39;: &#39;-79600&#39;,
 &#39;저가&#39;: &#39;-78400&#39;,
 &#39;상한가&#39;: &#39;+104000&#39;,
 &#39;하한가&#39;: &#39;-56000&#39;,
 &#39;기준가&#39;: &#39;80000&#39;,
 &#39;예상체결가&#39;: &#39;-0&#39;,
 &#39;예상체결수량&#39;: &#39;0&#39;,
 &#39;250최고가일&#39;: &#39;20210111&#39;,
 &#39;250최고가대비율&#39;: &#39;-18.90&#39;,
 &#39;250최저가일&#39;: &#39;20200513&#39;,
 &#39;250최저가대비율&#39;: &#39;+66.31&#39;,
 &#39;현재가&#39;: &#39;-78500&#39;,
 &#39;대비기호&#39;: &#39;5&#39;,
 &#39;전일대비&#39;: &#39;-1500&#39;,
 &#39;등락율&#39;: &#39;-1.88&#39;,
 &#39;거래량&#39;: &#39;31490096&#39;,
 &#39;거래대비&#39;: &#39;-87.93&#39;,
 &#39;액면가단위&#39;: &#39;원&#39;,
 &#39;유통주식&#39;: &#39;4706743&#39;,
 &#39;유통비율&#39;: &#39;78.8&#39;}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span> <span class="o">=</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">GetDailyStockDataAsDataFrame</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="c1"># opt10081</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-05-13 23:46:07,968 [DEBUG] Received 600 records from 2021-05-13 00:00:00 to 2018-12-06 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:46:08,342 [DEBUG] Received 600 records from 2018-12-05 00:00:00 to 2016-06-27 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:46:08,755 [DEBUG] Received 600 records from 2016-06-24 00:00:00 to 2014-01-16 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:46:09,147 [DEBUG] Received 600 records from 2014-01-15 00:00:00 to 2011-08-16 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:47:37,942 [DEBUG] Received 600 records from 2011-08-12 00:00:00 to 2009-03-26 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:47:55,994 [DEBUG] Received 600 records from 2009-03-25 00:00:00 to 2006-10-20 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:47:56,432 [DEBUG] Received 600 records from 2006-10-19 00:00:00 to 2004-05-27 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:47:56,889 [DEBUG] Received 600 records from 2004-05-25 00:00:00 to 2001-12-11 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:47:57,299 [DEBUG] Received 600 records from 2001-12-10 00:00:00 to 1999-07-02 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:48:13,915 [DEBUG] Received 600 records from 1999-07-01 00:00:00 to 1997-05-16 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:48:14,389 [DEBUG] Received 600 records from 1997-05-15 00:00:00 to 1995-04-27 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:48:14,799 [DEBUG] Received 600 records from 1995-04-26 00:00:00 to 1993-04-19 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:48:15,247 [DEBUG] Received 600 records from 1993-04-17 00:00:00 to 1991-04-02 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:48:32,000 [DEBUG] Received 600 records from 1991-04-01 00:00:00 to 1989-03-08 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:48:32,813 [DEBUG] Received 600 records from 1989-03-07 00:00:00 to 1987-02-17 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:48:33,248 [DEBUG] Received 600 records from 1987-02-16 00:00:00 to 1985-01-30 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:48:49,583 [DEBUG] Received 22 records from 1985-01-29 00:00:00 to 1985-01-04 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>종목코드</th>
      <th>현재가</th>
      <th>거래량</th>
      <th>거래대금</th>
      <th>일자</th>
      <th>시가</th>
      <th>고가</th>
      <th>저가</th>
      <th>수정주가구분</th>
      <th>수정비율</th>
      <th>대업종구분</th>
      <th>소업종구분</th>
      <th>종목정보</th>
      <th>수정주가이벤트</th>
      <th>전일종가</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>005930</td>
      <td>78500</td>
      <td>31490096</td>
      <td>2482903</td>
      <td>20210513</td>
      <td>78900</td>
      <td>79600</td>
      <td>78400</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td></td>
      <td>80000</td>
      <td>35812268</td>
      <td>2876602</td>
      <td>20210512</td>
      <td>80800</td>
      <td>81200</td>
      <td>79800</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td></td>
      <td>81200</td>
      <td>28996680</td>
      <td>2365998</td>
      <td>20210511</td>
      <td>82500</td>
      <td>82600</td>
      <td>81100</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>3</th>
      <td></td>
      <td>83200</td>
      <td>19385027</td>
      <td>1603729</td>
      <td>20210510</td>
      <td>82300</td>
      <td>83500</td>
      <td>81800</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>4</th>
      <td></td>
      <td>81900</td>
      <td>14154882</td>
      <td>1158685</td>
      <td>20210507</td>
      <td>81800</td>
      <td>82100</td>
      <td>81500</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>9617</th>
      <td></td>
      <td>8010</td>
      <td>4970</td>
      <td>1</td>
      <td>19850109</td>
      <td>8240</td>
      <td>8240</td>
      <td>7950</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>9618</th>
      <td></td>
      <td>8300</td>
      <td>12930</td>
      <td>4</td>
      <td>19850108</td>
      <td>8400</td>
      <td>8400</td>
      <td>8300</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>9619</th>
      <td></td>
      <td>8410</td>
      <td>11810</td>
      <td>3</td>
      <td>19850107</td>
      <td>8400</td>
      <td>8500</td>
      <td>8390</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>9620</th>
      <td></td>
      <td>8390</td>
      <td>1660</td>
      <td>0</td>
      <td>19850105</td>
      <td>8400</td>
      <td>8440</td>
      <td>8390</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>9621</th>
      <td></td>
      <td>8450</td>
      <td>1710</td>
      <td>0</td>
      <td>19850104</td>
      <td>8500</td>
      <td>8500</td>
      <td>8450</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>
<p>9622 rows × 15 columns</p>
</div></div>
</div>
<p>데이터가 최대한 있는 그대로 (주로 문자열 형태로) 반환되기 때문에 필요하다면 타입 변환을 거쳐 사용한다.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;일자&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">closes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;현재가&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">closes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x17f400a4f10&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_koapy-tutorial_35_1.png" src="../_images/notebooks_koapy-tutorial_35_1.png" />
</div>
</div>
<p>주가 데이터에서 수정주가가 필요한 경우에는 <code class="docutils literal notranslate"><span class="pre">adjusted_price=True</span></code> 파라미터를 설정해 호출한다.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">data_adjusted</span> <span class="o">=</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">GetDailyStockDataAsDataFrame</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">adjusted_price</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-05-13 23:48:50,289 [DEBUG] Received 600 records from 2021-05-13 00:00:00 to 2018-12-06 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:48:50,887 [DEBUG] Received 600 records from 2018-12-05 00:00:00 to 2016-06-27 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:49:07,971 [DEBUG] Received 600 records from 2016-06-24 00:00:00 to 2014-01-16 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:49:08,337 [DEBUG] Received 600 records from 2014-01-15 00:00:00 to 2011-08-16 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:49:08,854 [DEBUG] Received 600 records from 2011-08-12 00:00:00 to 2009-03-26 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:49:09,220 [DEBUG] Received 600 records from 2009-03-25 00:00:00 to 2006-10-20 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:49:25,954 [DEBUG] Received 600 records from 2006-10-19 00:00:00 to 2004-05-27 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:49:26,396 [DEBUG] Received 600 records from 2004-05-25 00:00:00 to 2001-12-11 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:49:26,867 [DEBUG] Received 600 records from 2001-12-10 00:00:00 to 1999-07-02 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:49:43,995 [DEBUG] Received 600 records from 1999-07-01 00:00:00 to 1997-05-16 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:49:44,358 [DEBUG] Received 600 records from 1997-05-15 00:00:00 to 1995-04-27 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:49:44,842 [DEBUG] Received 600 records from 1995-04-26 00:00:00 to 1993-04-19 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:50:37,908 [DEBUG] Received 600 records from 1993-04-17 00:00:00 to 1991-04-02 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:50:55,959 [DEBUG] Received 600 records from 1991-04-01 00:00:00 to 1989-03-08 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:50:56,408 [DEBUG] Received 600 records from 1989-03-07 00:00:00 to 1987-02-17 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:50:56,843 [DEBUG] Received 600 records from 1987-02-16 00:00:00 to 1985-01-30 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
2021-05-13 23:50:56,847 [DEBUG] Received 22 records from 1985-01-29 00:00:00 to 1985-01-04 00:00:00 for code 005930 - KiwoomOpenApiPlusServiceClientStubWrapper.py:599
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">data_adjusted</span><span class="p">[</span><span class="s1">&#39;일자&#39;</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">closes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">data_adjusted</span><span class="p">[</span><span class="s1">&#39;현재가&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">dates</span><span class="p">,</span> <span class="n">closes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;matplotlib.lines.Line2D at 0x17f40a85730&gt;]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_koapy-tutorial_39_1.png" src="../_images/notebooks_koapy-tutorial_39_1.png" />
</div>
</div>
</section>
<section id="하위-함수-사용-예시">
<h3>하위 함수 사용 예시<a class="headerlink" href="#하위-함수-사용-예시" title="Permalink to this headline">¶</a></h3>
<p>만약에 필요한 TR 에 대한 편의함수가 제공되지 않는 경우라면 아래처럼 직접 TR 요청에 필요한 입력값을 설정해 요청하고, 이후 스트림 형태로 들어오는 이벤트 또한 직접 처리해주는 방식으로 사용할 수 있다.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">rqname</span> <span class="o">=</span> <span class="s1">&#39;주식기본정보요청&#39;</span>
<span class="n">trcode</span> <span class="o">=</span> <span class="s1">&#39;opt10001&#39;</span>
<span class="n">screen_no</span> <span class="o">=</span> <span class="s1">&#39;0001&#39;</span> <span class="c1"># 화면번호, 0000 을 제외한 4자리 숫자 임의로 지정</span>
<span class="n">inputs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;종목코드&#39;</span><span class="p">:</span> <span class="n">code</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Requesting data for request name: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">rqname</span><span class="p">)</span>
<span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">TransactionCall</span><span class="p">(</span><span class="n">rqname</span><span class="p">,</span> <span class="n">trcode</span><span class="p">,</span> <span class="n">screen_no</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Got event for request: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">rqname</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">single_data</span><span class="o">.</span><span class="n">names</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">single_data</span><span class="o">.</span><span class="n">values</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">output</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-05-13 23:50:57,083 [INFO] Requesting data for request name: 주식기본정보요청 - &lt;ipython-input-27-84e17a5232d0&gt;:1
2021-05-13 23:51:13,550 [INFO] Got event for request: 주식기본정보요청 - &lt;ipython-input-27-84e17a5232d0&gt;:3
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">output</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;종목코드&#39;: &#39;005930&#39;,
 &#39;종목명&#39;: &#39;삼성전자&#39;,
 &#39;결산월&#39;: &#39;12&#39;,
 &#39;액면가&#39;: &#39;100&#39;,
 &#39;자본금&#39;: &#39;7780&#39;,
 &#39;상장주식&#39;: &#39;5969783&#39;,
 &#39;신용비율&#39;: &#39;+0.16&#39;,
 &#39;연중최고&#39;: &#39;+96800&#39;,
 &#39;연중최저&#39;: &#39;-78400&#39;,
 &#39;시가총액&#39;: &#39;4686279&#39;,
 &#39;시가총액비중&#39;: &#39;&#39;,
 &#39;외인소진률&#39;: &#39;+53.91&#39;,
 &#39;대용가&#39;: &#39;64000&#39;,
 &#39;PER&#39;: &#39;20.44&#39;,
 &#39;EPS&#39;: &#39;3841&#39;,
 &#39;ROE&#39;: &#39;10.0&#39;,
 &#39;PBR&#39;: &#39;1.99&#39;,
 &#39;EV&#39;: &#39;5.49&#39;,
 &#39;BPS&#39;: &#39;39406&#39;,
 &#39;매출액&#39;: &#39;2368070&#39;,
 &#39;영업이익&#39;: &#39;359939&#39;,
 &#39;당기순이익&#39;: &#39;264078&#39;,
 &#39;250최고&#39;: &#39;+96800&#39;,
 &#39;250최저&#39;: &#39;-47200&#39;,
 &#39;시가&#39;: &#39;-78900&#39;,
 &#39;고가&#39;: &#39;-79600&#39;,
 &#39;저가&#39;: &#39;-78400&#39;,
 &#39;상한가&#39;: &#39;+104000&#39;,
 &#39;하한가&#39;: &#39;-56000&#39;,
 &#39;기준가&#39;: &#39;80000&#39;,
 &#39;예상체결가&#39;: &#39;-0&#39;,
 &#39;예상체결수량&#39;: &#39;0&#39;,
 &#39;250최고가일&#39;: &#39;20210111&#39;,
 &#39;250최고가대비율&#39;: &#39;-18.90&#39;,
 &#39;250최저가일&#39;: &#39;20200513&#39;,
 &#39;250최저가대비율&#39;: &#39;+66.31&#39;,
 &#39;현재가&#39;: &#39;-78500&#39;,
 &#39;대비기호&#39;: &#39;5&#39;,
 &#39;전일대비&#39;: &#39;-1500&#39;,
 &#39;등락율&#39;: &#39;-1.88&#39;,
 &#39;거래량&#39;: &#39;31490096&#39;,
 &#39;거래대비&#39;: &#39;-87.93&#39;,
 &#39;액면가단위&#39;: &#39;원&#39;,
 &#39;유통주식&#39;: &#39;4706743&#39;,
 &#39;유통비율&#39;: &#39;78.8&#39;}
</pre></div></div>
</div>
<p>위의 코드에서 <code class="docutils literal notranslate"><span class="pre">TransactionCall()</span></code> 함수의 경우 반환되는 스트림의 <code class="docutils literal notranslate"><span class="pre">event</span></code> 객체는 <code class="docutils literal notranslate"><span class="pre">ListenResponse</span></code> 타입의 gRPC 메시지 형태로 반환된다.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">PrettyPrinter</span>
<span class="kn">from</span> <span class="nn">google.protobuf.json_format</span> <span class="kn">import</span> <span class="n">MessageToDict</span>

<span class="n">pp</span> <span class="o">=</span> <span class="n">PrettyPrinter</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">pprint_event</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="n">pp</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">MessageToDict</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">preserving_proto_field_name</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pprint_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;arguments&#39;: [{&#39;string_value&#39;: &#39;0001&#39;},
               {&#39;string_value&#39;: &#39;주식기본정보요청&#39;},
               {&#39;string_value&#39;: &#39;opt10001&#39;},
               {&#39;string_value&#39;: &#39;&#39;},
               {&#39;string_value&#39;: &#39;0&#39;}],
 &#39;name&#39;: &#39;OnReceiveTrData&#39;,
 &#39;single_data&#39;: {&#39;names&#39;: [&#39;종목코드&#39;,
                           &#39;종목명&#39;,
                           &#39;결산월&#39;,
                           &#39;액면가&#39;,
                           &#39;자본금&#39;,
                           &#39;상장주식&#39;,
                           &#39;신용비율&#39;,
                           &#39;연중최고&#39;,
                           &#39;연중최저&#39;,
                           &#39;시가총액&#39;,
                           &#39;시가총액비중&#39;,
                           &#39;외인소진률&#39;,
                           &#39;대용가&#39;,
                           &#39;PER&#39;,
                           &#39;EPS&#39;,
                           &#39;ROE&#39;,
                           &#39;PBR&#39;,
                           &#39;EV&#39;,
                           &#39;BPS&#39;,
                           &#39;매출액&#39;,
                           &#39;영업이익&#39;,
                           &#39;당기순이익&#39;,
                           &#39;250최고&#39;,
                           &#39;250최저&#39;,
                           &#39;시가&#39;,
                           &#39;고가&#39;,
                           &#39;저가&#39;,
                           &#39;상한가&#39;,
                           &#39;하한가&#39;,
                           &#39;기준가&#39;,
                           &#39;예상체결가&#39;,
                           &#39;예상체결수량&#39;,
                           &#39;250최고가일&#39;,
                           &#39;250최고가대비율&#39;,
                           &#39;250최저가일&#39;,
                           &#39;250최저가대비율&#39;,
                           &#39;현재가&#39;,
                           &#39;대비기호&#39;,
                           &#39;전일대비&#39;,
                           &#39;등락율&#39;,
                           &#39;거래량&#39;,
                           &#39;거래대비&#39;,
                           &#39;액면가단위&#39;,
                           &#39;유통주식&#39;,
                           &#39;유통비율&#39;],
                 &#39;values&#39;: [&#39;005930&#39;,
                            &#39;삼성전자&#39;,
                            &#39;12&#39;,
                            &#39;100&#39;,
                            &#39;7780&#39;,
                            &#39;5969783&#39;,
                            &#39;+0.16&#39;,
                            &#39;+96800&#39;,
                            &#39;-78400&#39;,
                            &#39;4686279&#39;,
                            &#39;&#39;,
                            &#39;+53.91&#39;,
                            &#39;64000&#39;,
                            &#39;20.44&#39;,
                            &#39;3841&#39;,
                            &#39;10.0&#39;,
                            &#39;1.99&#39;,
                            &#39;5.49&#39;,
                            &#39;39406&#39;,
                            &#39;2368070&#39;,
                            &#39;359939&#39;,
                            &#39;264078&#39;,
                            &#39;+96800&#39;,
                            &#39;-47200&#39;,
                            &#39;-78900&#39;,
                            &#39;-79600&#39;,
                            &#39;-78400&#39;,
                            &#39;+104000&#39;,
                            &#39;-56000&#39;,
                            &#39;80000&#39;,
                            &#39;-0&#39;,
                            &#39;0&#39;,
                            &#39;20210111&#39;,
                            &#39;-18.90&#39;,
                            &#39;20200513&#39;,
                            &#39;+66.31&#39;,
                            &#39;-78500&#39;,
                            &#39;5&#39;,
                            &#39;-1500&#39;,
                            &#39;-1.88&#39;,
                            &#39;31490096&#39;,
                            &#39;-87.93&#39;,
                            &#39;원&#39;,
                            &#39;4706743&#39;,
                            &#39;78.8&#39;]}}
</pre></div></div>
</div>
<p>해당 메시지의 형태는 <code class="docutils literal notranslate"><span class="pre">`koapy/backend/kiwoom_open_api_plus/grpc/KiwoomOpenApiPlusService.proto</span></code> &lt;<a class="reference external" href="https://github.com/elbakramer/koapy/blob/master/koapy/backend/kiwoom_open_api_plus/grpc/KiwoomOpenApiPlusService.proto">https://github.com/elbakramer/koapy/blob/master/koapy/backend/kiwoom_open_api_plus/grpc/KiwoomOpenApiPlusService.proto</a>&gt;`__ 파일의 내용, 구체적으로 아래와 같은 메시지의 정의 부분을 참고하기 바란다.</p>
<div class="highlight-proto notranslate"><div class="highlight"><pre><span></span><span class="kd">message</span> <span class="nc">SingleData</span> <span class="p">{</span>
  <span class="k">repeated</span> <span class="kt">string</span> <span class="na">names</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="kt">string</span> <span class="na">values</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">RepeatedString</span> <span class="p">{</span>
  <span class="k">repeated</span> <span class="kt">string</span> <span class="na">values</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">MultiData</span> <span class="p">{</span>
  <span class="k">repeated</span> <span class="kt">string</span> <span class="na">names</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="n">RepeatedString</span> <span class="na">values</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">ListenResponse</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="n">Argument</span> <span class="na">arguments</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="n">SingleData</span> <span class="na">single_data</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="n">MultiData</span> <span class="na">multi_data</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>각 TR 에 따라 싱글데이터/멀티데이터가 선택적으로 설정되어 반환되는데, 그러한 입력/출력과 관련된 정보들은 <a class="reference external" href="https://download.kiwoom.com/web/openapi/kiwoom_openapi_plus_devguide_ver_1.5.pdf#page=7">KOAStudio</a> 프로그램을 활용하거나 아니면 아래처럼 <code class="docutils literal notranslate"><span class="pre">KiwoomOpenApiPlusTrInfo</span></code> 를 통해 확인할 수 있다.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">koapy</span> <span class="kn">import</span> <span class="n">KiwoomOpenApiPlusTrInfo</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tr_info</span> <span class="o">=</span> <span class="n">KiwoomOpenApiPlusTrInfo</span><span class="o">.</span><span class="n">get_trinfo_by_code</span><span class="p">(</span><span class="s1">&#39;opt10001&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tr_info</span><span class="o">.</span><span class="n">inputs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[KiwoomOpenApiPlusTrInfo.Field(&#39;종목코드&#39;, 0, 6, 9001)]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tr_info</span><span class="o">.</span><span class="n">single_outputs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[KiwoomOpenApiPlusTrInfo.Field(&#39;종목코드&#39;, 0, 20, 389),
 KiwoomOpenApiPlusTrInfo.Field(&#39;종목명&#39;, 20, 50, 302),
 KiwoomOpenApiPlusTrInfo.Field(&#39;결산월&#39;, 40, 20, 315),
 KiwoomOpenApiPlusTrInfo.Field(&#39;액면가&#39;, 60, 20, 310),
 KiwoomOpenApiPlusTrInfo.Field(&#39;자본금&#39;, 80, 20, 309),
 KiwoomOpenApiPlusTrInfo.Field(&#39;상장주식&#39;, 100, 20, 312),
 KiwoomOpenApiPlusTrInfo.Field(&#39;신용비율&#39;, 120, 20, 329),
 KiwoomOpenApiPlusTrInfo.Field(&#39;연중최고&#39;, 140, 20, 1006),
 KiwoomOpenApiPlusTrInfo.Field(&#39;연중최저&#39;, 160, 20, 1009),
 KiwoomOpenApiPlusTrInfo.Field(&#39;시가총액&#39;, 180, 20, 311),
 KiwoomOpenApiPlusTrInfo.Field(&#39;시가총액비중&#39;, 200, 20, 336),
 KiwoomOpenApiPlusTrInfo.Field(&#39;외인소진률&#39;, 220, 20, 314),
 KiwoomOpenApiPlusTrInfo.Field(&#39;대용가&#39;, 240, 20, 308),
 KiwoomOpenApiPlusTrInfo.Field(&#39;PER&#39;, 260, 20, 1600),
 KiwoomOpenApiPlusTrInfo.Field(&#39;EPS&#39;, 280, 20, 1604),
 KiwoomOpenApiPlusTrInfo.Field(&#39;ROE&#39;, 300, 20, 1630),
 KiwoomOpenApiPlusTrInfo.Field(&#39;PBR&#39;, 320, 20, 1601),
 KiwoomOpenApiPlusTrInfo.Field(&#39;EV&#39;, 340, 20, 1608),
 KiwoomOpenApiPlusTrInfo.Field(&#39;BPS&#39;, 360, 20, 1605),
 KiwoomOpenApiPlusTrInfo.Field(&#39;매출액&#39;, 380, 20, 1610),
 KiwoomOpenApiPlusTrInfo.Field(&#39;영업이익&#39;, 400, 20, 1611),
 KiwoomOpenApiPlusTrInfo.Field(&#39;당기순이익&#39;, 420, 20, 1614),
 KiwoomOpenApiPlusTrInfo.Field(&#39;250최고&#39;, 440, 20, 1000),
 KiwoomOpenApiPlusTrInfo.Field(&#39;250최저&#39;, 460, 20, 1003),
 KiwoomOpenApiPlusTrInfo.Field(&#39;시가&#39;, 480, 20, 16),
 KiwoomOpenApiPlusTrInfo.Field(&#39;고가&#39;, 500, 20, 17),
 KiwoomOpenApiPlusTrInfo.Field(&#39;저가&#39;, 520, 20, 18),
 KiwoomOpenApiPlusTrInfo.Field(&#39;상한가&#39;, 540, 20, 305),
 KiwoomOpenApiPlusTrInfo.Field(&#39;하한가&#39;, 560, 20, 306),
 KiwoomOpenApiPlusTrInfo.Field(&#39;기준가&#39;, 580, 20, 307),
 KiwoomOpenApiPlusTrInfo.Field(&#39;예상체결가&#39;, 600, 20, 10023),
 KiwoomOpenApiPlusTrInfo.Field(&#39;예상체결수량&#39;, 620, 20, 10024),
 KiwoomOpenApiPlusTrInfo.Field(&#39;250최고가일&#39;, 640, 20, 1001),
 KiwoomOpenApiPlusTrInfo.Field(&#39;250최고가대비율&#39;, 660, 20, 1002),
 KiwoomOpenApiPlusTrInfo.Field(&#39;250최저가일&#39;, 680, 20, 1004),
 KiwoomOpenApiPlusTrInfo.Field(&#39;250최저가대비율&#39;, 700, 20, 1005),
 KiwoomOpenApiPlusTrInfo.Field(&#39;현재가&#39;, 720, 20, 10),
 KiwoomOpenApiPlusTrInfo.Field(&#39;대비기호&#39;, 740, 20, 25),
 KiwoomOpenApiPlusTrInfo.Field(&#39;전일대비&#39;, 760, 20, 11),
 KiwoomOpenApiPlusTrInfo.Field(&#39;등락율&#39;, 780, 20, 12),
 KiwoomOpenApiPlusTrInfo.Field(&#39;거래량&#39;, 800, 20, 13),
 KiwoomOpenApiPlusTrInfo.Field(&#39;거래대비&#39;, 820, 20, 30),
 KiwoomOpenApiPlusTrInfo.Field(&#39;액면가단위&#39;, 840, 20, 796),
 KiwoomOpenApiPlusTrInfo.Field(&#39;유통주식&#39;, 840, 20, 1683),
 KiwoomOpenApiPlusTrInfo.Field(&#39;유통비율&#39;, 840, 20, 1684)]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tr_info</span><span class="o">.</span><span class="n">multi_outputs</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[]
</pre></div></div>
</div>
</section>
</section>
<section id="5.-조건검색-예시">
<h2>5. 조건검색 예시<a class="headerlink" href="#5.-조건검색-예시" title="Permalink to this headline">¶</a></h2>
<p>조건검색을 사용하기 위해서는 먼저 서버에 저장된 조건들을 불러와야 한다.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">entrypoint</span><span class="o">.</span><span class="n">EnsureConditionLoaded</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1
</pre></div></div>
</div>
<p>불러온 조건들의 목록은 아래 함수로 확인이 가능하다.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">conditions</span> <span class="o">=</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">GetConditionNameListAsList</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">conditions</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[(0, &#39;대형 저평가 우량주&#39;), (1, &#39;중소형 저평가주&#39;)]
</pre></div></div>
</div>
<p>이후 예시의 정상동작을 위해서는 아래에서 사용되는 조건들과 같은 이름을 가지는 조건들이 미리 저장되어 있어야 한다.</p>
<ul class="simple">
<li><p>대형 저평가 우량주</p></li>
<li><p>중소형 저평가주</p></li>
</ul>
<p>위의 조건식들은 키움에서 예시로 제공하는 추천식들을 그대로 이름을 똑같이 해서 저장한 것들이다. 참고로 조건들을 편집하고 저장하는건 영웅문 HTS 내부에서만 가능하기 때문에 따로 HTS 를 열어 편집해주어야 한다.</p>
<p>조건식이 편집된 이후에 해당 조건식을 기존에 동작중인 OpenAPI 에도 갱신하고 싶은 경우, 아래 함수를 통해 편집된 조건식을 새로 불러온다.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">entrypoint</span><span class="o">.</span><span class="n">LoadCondition</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
1
</pre></div></div>
</div>
<section id="일반-조건검색-예시">
<h3>일반 조건검색 예시<a class="headerlink" href="#일반-조건검색-예시" title="Permalink to this headline">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">condition_name</span> <span class="o">=</span> <span class="s1">&#39;대형 저평가 우량주&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">codes</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">GetCodeListByCondition</span><span class="p">(</span><span class="n">condition_name</span><span class="p">,</span> <span class="n">with_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>위의 함수에서 <code class="docutils literal notranslate"><span class="pre">with_info=True</span></code> 로 호출하게 되면 조건을 만족하는 코드 목록 (<code class="docutils literal notranslate"><span class="pre">codes</span></code>) 뿐만 아니라 해당 종목들에 대한 기본정보들도 (<code class="docutils literal notranslate"><span class="pre">info</span></code>) 같이 가져와 DataFrame 형태로 제공한다.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">info</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[42]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>종목코드</th>
      <th>종목명</th>
      <th>현재가</th>
      <th>기준가</th>
      <th>전일대비</th>
      <th>전일대비기호</th>
      <th>등락율</th>
      <th>거래량</th>
      <th>거래대금</th>
      <th>체결량</th>
      <th>...</th>
      <th>ELW만기일</th>
      <th>미결제약정</th>
      <th>미결제전일대비</th>
      <th>이론가</th>
      <th>내재변동성</th>
      <th>델타</th>
      <th>감마</th>
      <th>쎄타</th>
      <th>베가</th>
      <th>로</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>000240</td>
      <td>한국앤컴퍼니</td>
      <td>-18650</td>
      <td>19050</td>
      <td>-400</td>
      <td>5</td>
      <td>-2.10</td>
      <td>209278</td>
      <td>3937</td>
      <td>-3</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>1</th>
      <td>001630</td>
      <td>종근당홀딩스</td>
      <td>+110500</td>
      <td>110000</td>
      <td>+500</td>
      <td>2</td>
      <td>+0.45</td>
      <td>16107</td>
      <td>1759</td>
      <td>+3</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>2</th>
      <td>001800</td>
      <td>오리온홀딩스</td>
      <td>+17900</td>
      <td>17800</td>
      <td>+100</td>
      <td>2</td>
      <td>+0.56</td>
      <td>498369</td>
      <td>8919</td>
      <td>-1</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>3</th>
      <td>001880</td>
      <td>DL건설</td>
      <td>-35600</td>
      <td>36450</td>
      <td>-850</td>
      <td>5</td>
      <td>-2.33</td>
      <td>115738</td>
      <td>4128</td>
      <td>-9</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>4</th>
      <td>003230</td>
      <td>삼양식품</td>
      <td>+97500</td>
      <td>95100</td>
      <td>+2400</td>
      <td>2</td>
      <td>+2.52</td>
      <td>140072</td>
      <td>13480</td>
      <td>+1</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>5</th>
      <td>003800</td>
      <td>에이스침대</td>
      <td>+46000</td>
      <td>42650</td>
      <td>+3350</td>
      <td>2</td>
      <td>+7.85</td>
      <td>17107</td>
      <td>762</td>
      <td>+3</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>6</th>
      <td>004000</td>
      <td>롯데정밀화학</td>
      <td>-60800</td>
      <td>61500</td>
      <td>-700</td>
      <td>5</td>
      <td>-1.14</td>
      <td>265348</td>
      <td>16250</td>
      <td>+69</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>7</th>
      <td>006040</td>
      <td>동원산업</td>
      <td>-303000</td>
      <td>303500</td>
      <td>-500</td>
      <td>5</td>
      <td>-0.16</td>
      <td>8320</td>
      <td>2532</td>
      <td>-1</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>8</th>
      <td>006390</td>
      <td>한일현대시멘트</td>
      <td>-41750</td>
      <td>42400</td>
      <td>-650</td>
      <td>5</td>
      <td>-1.53</td>
      <td>45490</td>
      <td>1911</td>
      <td>-3</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>9</th>
      <td>006650</td>
      <td>대한유화</td>
      <td>-267500</td>
      <td>276500</td>
      <td>-9000</td>
      <td>5</td>
      <td>-3.25</td>
      <td>87900</td>
      <td>23776</td>
      <td>+1</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>10</th>
      <td>008490</td>
      <td>서흥</td>
      <td>+54400</td>
      <td>53900</td>
      <td>+500</td>
      <td>2</td>
      <td>+0.93</td>
      <td>29526</td>
      <td>1597</td>
      <td>-3</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>11</th>
      <td>009970</td>
      <td>영원무역홀딩스</td>
      <td>-53000</td>
      <td>54800</td>
      <td>-1800</td>
      <td>5</td>
      <td>-3.28</td>
      <td>27530</td>
      <td>1476</td>
      <td>-6</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>12</th>
      <td>011780</td>
      <td>금호석유</td>
      <td>-236500</td>
      <td>250500</td>
      <td>-14000</td>
      <td>5</td>
      <td>-5.59</td>
      <td>1178557</td>
      <td>280638</td>
      <td>+12</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>13</th>
      <td>012630</td>
      <td>HDC</td>
      <td>-14200</td>
      <td>14600</td>
      <td>-400</td>
      <td>5</td>
      <td>-2.74</td>
      <td>1429993</td>
      <td>20429</td>
      <td>-520</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>14</th>
      <td>013120</td>
      <td>동원개발</td>
      <td>-6240</td>
      <td>6400</td>
      <td>-160</td>
      <td>5</td>
      <td>-2.50</td>
      <td>340464</td>
      <td>2128</td>
      <td>+6</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>15</th>
      <td>014830</td>
      <td>유니드</td>
      <td>-78100</td>
      <td>80000</td>
      <td>-1900</td>
      <td>5</td>
      <td>-2.38</td>
      <td>68792</td>
      <td>5363</td>
      <td>+2</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>16</th>
      <td>016800</td>
      <td>퍼시스</td>
      <td>-44000</td>
      <td>44100</td>
      <td>-100</td>
      <td>5</td>
      <td>-0.23</td>
      <td>61478</td>
      <td>2783</td>
      <td>1280</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>17</th>
      <td>017960</td>
      <td>한국카본</td>
      <td>-11750</td>
      <td>12000</td>
      <td>-250</td>
      <td>5</td>
      <td>-2.08</td>
      <td>696742</td>
      <td>8219</td>
      <td>-10</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>18</th>
      <td>020000</td>
      <td>한섬</td>
      <td>-48850</td>
      <td>49700</td>
      <td>-850</td>
      <td>5</td>
      <td>-1.71</td>
      <td>151204</td>
      <td>7400</td>
      <td>-10</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>19</th>
      <td>021240</td>
      <td>코웨이</td>
      <td>+76600</td>
      <td>69900</td>
      <td>+6700</td>
      <td>2</td>
      <td>+9.59</td>
      <td>1755822</td>
      <td>131428</td>
      <td>-48</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>20</th>
      <td>024720</td>
      <td>한국콜마홀딩스</td>
      <td>-31200</td>
      <td>31300</td>
      <td>-100</td>
      <td>5</td>
      <td>-0.32</td>
      <td>93228</td>
      <td>2900</td>
      <td>-1</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>21</th>
      <td>025540</td>
      <td>한국단자</td>
      <td>+80200</td>
      <td>79800</td>
      <td>+400</td>
      <td>2</td>
      <td>+0.50</td>
      <td>57605</td>
      <td>4616</td>
      <td>+3</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>22</th>
      <td>028150</td>
      <td>GS홈쇼핑</td>
      <td>-146300</td>
      <td>148700</td>
      <td>-2400</td>
      <td>5</td>
      <td>-1.61</td>
      <td>25105</td>
      <td>3678</td>
      <td>-2</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>23</th>
      <td>033290</td>
      <td>코웰패션</td>
      <td>-6600</td>
      <td>6670</td>
      <td>-70</td>
      <td>5</td>
      <td>-1.05</td>
      <td>426139</td>
      <td>2821</td>
      <td>-161</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>24</th>
      <td>033780</td>
      <td>KT&amp;G</td>
      <td>-82000</td>
      <td>82600</td>
      <td>-600</td>
      <td>5</td>
      <td>-0.73</td>
      <td>906987</td>
      <td>74439</td>
      <td>-10</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>25</th>
      <td>036830</td>
      <td>솔브레인홀딩스</td>
      <td>-39150</td>
      <td>40100</td>
      <td>-950</td>
      <td>5</td>
      <td>-2.37</td>
      <td>73709</td>
      <td>2905</td>
      <td>-10</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>26</th>
      <td>049070</td>
      <td>인탑스</td>
      <td>29450</td>
      <td>29450</td>
      <td>0</td>
      <td>3</td>
      <td>0.00</td>
      <td>48531</td>
      <td>1415</td>
      <td>-11</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>27</th>
      <td>056190</td>
      <td>에스에프에이</td>
      <td>-39650</td>
      <td>40250</td>
      <td>-600</td>
      <td>5</td>
      <td>-1.49</td>
      <td>181122</td>
      <td>7236</td>
      <td>-5</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>28</th>
      <td>069080</td>
      <td>웹젠</td>
      <td>-31300</td>
      <td>31800</td>
      <td>-500</td>
      <td>5</td>
      <td>-1.57</td>
      <td>318901</td>
      <td>10105</td>
      <td>-8</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>29</th>
      <td>084010</td>
      <td>대한제강</td>
      <td>-21550</td>
      <td>24450</td>
      <td>-2900</td>
      <td>5</td>
      <td>-11.86</td>
      <td>945476</td>
      <td>21474</td>
      <td>+10</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>30</th>
      <td>095660</td>
      <td>네오위즈</td>
      <td>+24600</td>
      <td>23200</td>
      <td>+1400</td>
      <td>2</td>
      <td>+6.03</td>
      <td>1101355</td>
      <td>27174</td>
      <td>+1</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>31</th>
      <td>096530</td>
      <td>씨젠</td>
      <td>-79000</td>
      <td>80000</td>
      <td>-1000</td>
      <td>5</td>
      <td>-1.25</td>
      <td>512611</td>
      <td>40508</td>
      <td>+1</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>32</th>
      <td>102710</td>
      <td>이엔에프테크놀로지</td>
      <td>-36350</td>
      <td>36900</td>
      <td>-550</td>
      <td>5</td>
      <td>-1.49</td>
      <td>158493</td>
      <td>5777</td>
      <td>-100</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>33</th>
      <td>111770</td>
      <td>영원무역</td>
      <td>-46250</td>
      <td>48200</td>
      <td>-1950</td>
      <td>5</td>
      <td>-4.05</td>
      <td>262358</td>
      <td>12412</td>
      <td>-9</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>34</th>
      <td>161890</td>
      <td>한국콜마</td>
      <td>+57000</td>
      <td>56900</td>
      <td>+100</td>
      <td>2</td>
      <td>+0.18</td>
      <td>172586</td>
      <td>9785</td>
      <td>-1</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>35</th>
      <td>192080</td>
      <td>더블유게임즈</td>
      <td>-64800</td>
      <td>65500</td>
      <td>-700</td>
      <td>5</td>
      <td>-1.07</td>
      <td>122822</td>
      <td>7933</td>
      <td>-3</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>36</th>
      <td>192400</td>
      <td>쿠쿠홀딩스</td>
      <td>-133500</td>
      <td>135500</td>
      <td>-2000</td>
      <td>5</td>
      <td>-1.48</td>
      <td>7979</td>
      <td>1071</td>
      <td>+2</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>37</th>
      <td>204270</td>
      <td>제이앤티씨</td>
      <td>-9910</td>
      <td>10050</td>
      <td>-140</td>
      <td>5</td>
      <td>-1.39</td>
      <td>179804</td>
      <td>1782</td>
      <td>+8</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>38</th>
      <td>230360</td>
      <td>에코마케팅</td>
      <td>-23700</td>
      <td>23950</td>
      <td>-250</td>
      <td>5</td>
      <td>-1.04</td>
      <td>147151</td>
      <td>3501</td>
      <td>+7</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>39</th>
      <td>243070</td>
      <td>휴온스</td>
      <td>-62900</td>
      <td>63300</td>
      <td>-400</td>
      <td>5</td>
      <td>-0.63</td>
      <td>545279</td>
      <td>35090</td>
      <td>+300</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>40</th>
      <td>281820</td>
      <td>케이씨텍</td>
      <td>-27700</td>
      <td>28600</td>
      <td>-900</td>
      <td>5</td>
      <td>-3.15</td>
      <td>146173</td>
      <td>4071</td>
      <td>+2</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>41</th>
      <td>284740</td>
      <td>쿠쿠홈시스</td>
      <td>+45300</td>
      <td>41300</td>
      <td>+4000</td>
      <td>2</td>
      <td>+9.69</td>
      <td>349859</td>
      <td>15601</td>
      <td>-100</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>42</th>
      <td>285130</td>
      <td>SK케미칼</td>
      <td>-250000</td>
      <td>252000</td>
      <td>-2000</td>
      <td>5</td>
      <td>-0.79</td>
      <td>97315</td>
      <td>24305</td>
      <td>+1</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>43</th>
      <td>294870</td>
      <td>HDC현대산업개발</td>
      <td>-28600</td>
      <td>29000</td>
      <td>-400</td>
      <td>5</td>
      <td>-1.38</td>
      <td>668065</td>
      <td>19168</td>
      <td>-99</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th>44</th>
      <td>300720</td>
      <td>한일시멘트</td>
      <td>-160500</td>
      <td>166500</td>
      <td>-6000</td>
      <td>5</td>
      <td>-3.60</td>
      <td>15679</td>
      <td>2553</td>
      <td>+1</td>
      <td>...</td>
      <td>00000000</td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
</table>
<p>45 rows × 63 columns</p>
</div></div>
</div>
</section>
<section id="실시간-조건검색-예시">
<h3>실시간 조건검색 예시<a class="headerlink" href="#실시간-조건검색-예시" title="Permalink to this headline">¶</a></h3>
<p>같은 조건식은 1분에 1건 제한이므로 예시 실행시 제한을 회피하기 위해서 새로 설정한다.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[43]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">condition_name</span> <span class="o">=</span> <span class="s1">&#39;중소형 저평가주&#39;</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Start listening realtime condition stream...&#39;</span><span class="p">)</span>
<span class="n">stream</span> <span class="o">=</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">GetCodeListByConditionAsStream</span><span class="p">(</span><span class="n">condition_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-05-13 23:51:14,292 [INFO] Start listening realtime condition stream... - &lt;ipython-input-44-f04b6a919f1c&gt;:1
</pre></div></div>
</div>
<p>실시간 조건검색의 경우 조건에 만족/불만족하는 종목이 편입/이탈할때마다 계속해서 이벤트를 반환한다. 예시에서는 10초 동안만 이벤트를 확인해본다.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">threading</span>

<span class="k">def</span> <span class="nf">stop_listening</span><span class="p">():</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Stop listening realtime condition events...&#39;</span><span class="p">)</span>
    <span class="n">stream</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

<span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">stop_listening</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="c1"># 10초 이후에 gRPC 커넥션 종료하도록 설정</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[46]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">grpc</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">stream</span><span class="p">:</span>
        <span class="n">pprint_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
<span class="k">except</span> <span class="n">grpc</span><span class="o">.</span><span class="n">RpcError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;arguments&#39;: [{&#39;string_value&#39;: &#39;2372&#39;},
               {&#39;string_value&#39;: &#39;900290;900340;002170;036190;037710;042420;046940;083550;084650;225220;248170;352700;950190;&#39;},
               {&#39;string_value&#39;: &#39;중소형 저평가주&#39;},
               {&#39;long_value&#39;: &#39;1&#39;},
               {&#39;long_value&#39;: &#39;0&#39;}],
 &#39;name&#39;: &#39;OnReceiveTrCondition&#39;}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-05-13 23:51:24,321 [INFO] Stop listening realtime condition events... - &lt;ipython-input-45-c769dc00f6f7&gt;:4
</pre></div></div>
</div>
<p>위에서 <code class="docutils literal notranslate"><span class="pre">stream</span></code> 결과는 <code class="docutils literal notranslate"><span class="pre">`grpc</span></code> &lt;<a class="reference external" href="https://grpc.github.io/grpc/python/">https://grpc.github.io/grpc/python/</a>&gt;`__ 의 <code class="docutils literal notranslate"><span class="pre">`_MultiThreadedRendezvous</span></code> &lt;<a class="reference external" href="https://github.com/grpc/grpc/blob/53ba4a101e80e1a67d4ec741b7e1aad6ea8d790f/src/python/grpcio/grpc/_channel.py#L652">https://github.com/grpc/grpc/blob/53ba4a101e80e1a67d4ec741b7e1aad6ea8d790f/src/python/grpcio/grpc/_channel.py#L652</a>&gt;`__ 객체인데 사실 해당 타입은 직접적으로 외부에 노출되는 타입은 아님. 대신에 해당 타입은 내부적으로 <code class="docutils literal notranslate"><span class="pre">`grpc.RpcError</span></code> &lt;<a class="reference external" href="https://grpc.github.io/grpc/python/grpc.html?highlight=rpcerror#grpc.RpcError">https://grpc.github.io/grpc/python/grpc.html?highlight=rpcerror#grpc.RpcError</a>&gt;`__,
<code class="docutils literal notranslate"><span class="pre">`grpc.RpcContext</span></code> &lt;<a class="reference external" href="https://grpc.github.io/grpc/python/grpc.html?highlight=rpccontext#grpc.RpcContext">https://grpc.github.io/grpc/python/grpc.html?highlight=rpccontext#grpc.RpcContext</a>&gt;`__, <code class="docutils literal notranslate"><span class="pre">`grpc.Call</span></code> &lt;<a class="reference external" href="https://grpc.github.io/grpc/python/grpc.html?highlight=call#grpc.Call">https://grpc.github.io/grpc/python/grpc.html?highlight=call#grpc.Call</a>&gt;`__, <code class="docutils literal notranslate"><span class="pre">`grpc.Future</span></code> &lt;&gt;`__ 인터페이스를 구현하고 있으므로 해당 객체의 사용법과 관련해서는 각각의 인터페이스를 참고하기 바람.</p>
</section>
</section>
<section id="6.-주문처리-예시">
<h2>6. 주문처리 예시<a class="headerlink" href="#6.-주문처리-예시" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">first_account_no</span> <span class="o">=</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">GetFirstAvailableAccount</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">request_name</span> <span class="o">=</span> <span class="s1">&#39;삼성전자 1주 시장가 신규 매수&#39;</span> <span class="c1"># 사용자 구분명, 구분가능한 임의의 문자열</span>
<span class="n">screen_no</span> <span class="o">=</span> <span class="s1">&#39;0001&#39;</span>                           <span class="c1"># 화면번호, 0000 을 제외한 4자리 숫자 임의로 지정</span>
<span class="n">account_no</span> <span class="o">=</span> <span class="n">first_account_no</span>                <span class="c1"># 계좌번호 10자리, 여기서는 계좌번호 목록에서 첫번째로 발견한 계좌번호로 매수처리</span>
<span class="n">order_type</span> <span class="o">=</span> <span class="mi">1</span>         <span class="c1"># 주문유형, 1 : 신규매수</span>
<span class="n">code</span> <span class="o">=</span> <span class="n">samsung_code</span>    <span class="c1"># 종목코드, 앞의 삼성전자 종목코드</span>
<span class="n">quantity</span> <span class="o">=</span> <span class="mi">1</span>           <span class="c1"># 주문수량, 1주 매수</span>
<span class="n">price</span> <span class="o">=</span> <span class="mi">0</span>              <span class="c1"># 주문가격, 시장가 매수는 가격설정 의미없음</span>
<span class="n">quote_type</span> <span class="o">=</span> <span class="s1">&#39;03&#39;</span>      <span class="c1"># 거래구분, 03 : 시장가</span>
<span class="n">original_order_no</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># 원주문번호, 주문 정정/취소 등에서 사용</span>
</pre></div>
</div>
</div>
<p>주문유형 및 거래구분 등과 관련된 자세한 정보들은 <a class="reference external" href="https://download.kiwoom.com/web/openapi/kiwoom_openapi_plus_devguide_ver_1.5.pdf#page=7">KOAStudio</a> 프로그램에서 확인할 수 있다.</p>
<p>주문처리는 실제 시장이 열려있는 동안에만 테스트해볼 수 있기 때문에, 현재 장이 열려 있는지 먼저 확인하고 해당 경우에 한정해서 테스트를 진행한다.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[49]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">Timestamp</span>
<span class="kn">from</span> <span class="nn">exchange_calendars</span> <span class="kn">import</span> <span class="n">get_calendar</span>

<span class="n">krx_calendar</span> <span class="o">=</span> <span class="n">get_calendar</span><span class="p">(</span><span class="s1">&#39;XKRX&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">is_currently_in_session</span><span class="p">():</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">Timestamp</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">krx_calendar</span><span class="o">.</span><span class="n">tz</span><span class="p">)</span>
    <span class="n">previous_open</span> <span class="o">=</span> <span class="n">krx_calendar</span><span class="o">.</span><span class="n">previous_open</span><span class="p">(</span><span class="n">now</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">krx_calendar</span><span class="o">.</span><span class="n">tz</span><span class="p">)</span>
    <span class="n">next_close</span> <span class="o">=</span> <span class="n">krx_calendar</span><span class="o">.</span><span class="n">next_close</span><span class="p">(</span><span class="n">previous_open</span><span class="p">)</span><span class="o">.</span><span class="n">astimezone</span><span class="p">(</span><span class="n">krx_calendar</span><span class="o">.</span><span class="n">tz</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">previous_open</span> <span class="o">&lt;=</span> <span class="n">now</span> <span class="o">&lt;=</span> <span class="n">next_close</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[50]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">if</span> <span class="n">is_currently_in_session</span><span class="p">():</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Sending order to buy </span><span class="si">%s</span><span class="s1">, quantity of 1 stock, at market price...&#39;</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">OrderCall</span><span class="p">(</span><span class="n">request_name</span><span class="p">,</span> <span class="n">screen_no</span><span class="p">,</span> <span class="n">account_no</span><span class="p">,</span> <span class="n">order_type</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">quote_type</span><span class="p">,</span> <span class="n">original_order_no</span><span class="p">):</span>
        <span class="n">pprint_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Cannot send an order while market is not open, skipping...&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-05-13 23:51:24,641 [INFO] Cannot send an order while market is not open, skipping... - &lt;ipython-input-50-37048f99b24d&gt;:6
</pre></div></div>
</div>
<p>주문 이벤트는 기본적으로 주문수량이 모두 소진되기 전까지 이벤트를 듣도록 되어있으며, 다른 이벤트 스트림과 동일하게 <code class="docutils literal notranslate"><span class="pre">stream.cancel()</span></code> 의 형태로 이벤트 스트림을 더이상 듣지 않도록 하는것이 가능하다. 다만 이벤트 스트림을 취소하는 것이 기존 주문까지 취소하는 것은 아니기 때문에 주문취소나 정정등을 위해서는 별도의 취소/정정 주문을 넣어줘야 한다.</p>
<p>여기서 반환되는 이벤트 객체 역시 앞선 TR 예시에서와 동일하게 <code class="docutils literal notranslate"><span class="pre">ListenResponse</span></code> 타입의 gRPC 메시지 형태로 반환된다.</p>
</section>
<section id="7.-실시간-데이터-처리-예시">
<h2>7. 실시간 데이터 처리 예시<a class="headerlink" href="#7.-실시간-데이터-처리-예시" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">koapy</span> <span class="kn">import</span> <span class="n">KiwoomOpenApiPlusRealType</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[52]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">code_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">code</span><span class="p">]</span>
<span class="n">fid_list</span> <span class="o">=</span> <span class="n">KiwoomOpenApiPlusRealType</span><span class="o">.</span><span class="n">get_fids_by_realtype_name</span><span class="p">(</span><span class="s1">&#39;주식시세&#39;</span><span class="p">)</span>
<span class="n">real_type</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="c1"># 기존 화면에 추가가 아니라 신규 생성, 1 의 경우 기존 화면번호에 추가</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Start listening realtime stock data for code: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
<span class="n">stream</span> <span class="o">=</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">GetRealDataForCodesAsStream</span><span class="p">(</span><span class="n">code_list</span><span class="p">,</span> <span class="n">fid_list</span><span class="p">,</span> <span class="n">real_type</span><span class="p">,</span> <span class="n">screen_no</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">infer_fids</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readable_names</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fast_parse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-05-13 23:51:24,690 [INFO] Start listening realtime stock data for code: 005930 - &lt;ipython-input-53-d908d1a08033&gt;:1
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[54]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">threading</span>

<span class="k">def</span> <span class="nf">stop_listening</span><span class="p">():</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Stop listening realtime events...&#39;</span><span class="p">)</span>
    <span class="n">stream</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

<span class="n">threading</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">stop_listening</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">()</span> <span class="c1"># 10초 이후에 gRPC 커넥션 종료하도록 설정</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[55]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">grpc</span>

<span class="k">try</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">event</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">stream</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">pprint_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="c1"># 노트북 출력이 너무 길어질 수 있어 최초 10개만 출력</span>
<span class="k">except</span> <span class="n">grpc</span><span class="o">.</span><span class="n">RpcError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
2021-05-13 23:51:34,717 [INFO] Stop listening realtime events... - &lt;ipython-input-54-f9a2c4046337&gt;:4
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;_MultiThreadedRendezvous of RPC that terminated with:
        status = StatusCode.CANCELLED
        details = &#34;Locally cancelled by application!&#34;
        debug_error_string = &#34;None&#34;
&gt;
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2021, Yunseong Hwang.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/notebooks/koapy-tutorial.ipynb"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/elbakramer/koapy" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-179490468-1']);
      _gaq.push(['_setDomainName', 'none']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    
  </body>
</html>